!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@antv/g"),require("@antv/g-canvas")):"function"==typeof define&&define.amd?define(["exports","@antv/g","@antv/g-canvas"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).G=t.G||{},t.G.RoughCanvasRenderer={}),t.window.G,t.window.G.Canvas2D)}(this,(function(t,e,n){"use strict";function r(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
r=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",i=o.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function c(t,e,n,r){var o=Object.create((e&&e.prototype instanceof f?e:f).prototype),s=new P(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(o,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw s;return L()}for(n.method=o,n.arg=s;;){var a=n.delegate;if(a){var i=b(a,n);if(i){if(i===u)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var h=l(t,e,n);if("normal"===h.type){if(r=n.done?"completed":"suspendedYield",h.arg===u)continue;return{value:h.arg,done:n.done}}"throw"===h.type&&(r="completed",n.method="throw",n.arg=h.arg)}}}(t,n,s),o}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var u={};function f(){}function p(){}function d(){}var g={};h(g,s,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(O([])));v&&v!==e&&n.call(v,s)&&(g=v);var k=d.prototype=f.prototype=Object.create(g);function M(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function m(t,e){function r(o,s,a,i){var h=l(t[o],t,s);if("throw"!==h.type){var c=h.arg,u=c.value;return u&&"object"==typeof u&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,a,i)}),(function(t){r("throw",t,a,i)})):e.resolve(u).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,i)}))}i(h.arg)}var o;this._invoke=function(t,n){function s(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(s,s):s()}}function b(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=l(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,u;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function w(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(w,this),this.reset(!0)}function O(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:L}}function L(){return{value:void 0,done:!0}}return p.prototype=d,h(k,"constructor",d),h(d,"constructor",p),p.displayName=h(d,i,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,h(t,i,"GeneratorFunction")),t.prototype=Object.create(k),t},t.awrap=function(t){return{__await:t}},M(m.prototype),h(m.prototype,a,(function(){return this})),t.AsyncIterator=m,t.async=function(e,n,r,o,s){void 0===s&&(s=Promise);var a=new m(c(e,n,r,o),s);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},M(k),h(k,i,"Generator"),h(k,s,(function(){return this})),h(k,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=O,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return r("end");if(this.prev>=s.tryLoc){var i=n.call(s,"catchLoc"),h=n.call(s,"finallyLoc");if(i&&h){if(s.catchLoc>this.prev)return r(s.catchLoc,!0);if(s.finallyLoc>this.prev)return r(s.finallyLoc)}else if(i){if(s.catchLoc>this.prev)return r(s.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(s.finallyLoc>this.prev)return r(s.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(this.prev>=o.tryLoc&&n.call(o,"finallyLoc")&&o.finallyLoc>this.prev){var s=o;break}}s&&("break"===t||"continue"===t)&&e>=s.tryLoc&&s.finallyLoc>=e&&(s=null);var a=s?s.completion:{};return a.type=t,a.arg=e,s?(this.method="next",this.next=s.finallyLoc,u):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;x(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:O(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},t}function o(t,e,n,r,o,s,a){try{var i=t[s](a),h=i.value}catch(t){return void n(t)}i.done?e(h):Promise.resolve(h).then(r,o)}function s(t){return function(){var e=this,n=arguments;return new Promise((function(r,s){var a=t.apply(e,n);function i(t){o(a,r,s,i,h,"next",t)}function h(t){o(a,r,s,i,h,"throw",t)}i(void 0)}))}}function a(t,e){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},a(t,e)}function i(t,e,n,r){var o,s=arguments.length,a=3>s?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var i=t.length-1;i>=0;i--)(o=t[i])&&(a=(3>s?o(a):s>3?o(e,n,a):o(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a}function h(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function c(t){var e=t.parsedStyle,n=e.stroke,r=e.lineWidth,o=e.fillStyle,s=e.fillWeight,a=e.hachureAngle,i=e.hachureGap,h=e.curveStepCount,c=e.curveFitting,l=e.lineDash,u=e.lineDashOffset,f=e.fillLineDash,p=e.fillLineDashOffset,d=e.disableMultiStroke,g=e.disableMultiStrokeFill,y=e.simplification,v=e.dashOffset,k=e.dashGap,M=e.zigzagOffset,m=e.preserveVertices,b={bowing:e.bowing,roughness:e.roughness,seed:e.seed||t.entity,fill:e.fill.toString(),stroke:n.toString(),strokeWidth:r,fillStyle:o,fillWeight:s,hachureAngle:a,hachureGap:i,curveStepCount:h,curveFitting:c,strokeLineDash:l,strokeLineDashOffset:u,fillLineDash:f,fillLineDashOffset:p,disableMultiStroke:d,disableMultiStrokeFill:g,simplification:y,dashOffset:v,dashGap:k,zigzagOffset:M,preserveVertices:m};return Object.keys(b).forEach((function(t){void 0===b[t]&&delete b[t]})),b}var l=function(){function t(){}return t.prototype.render=function(t,e,n){var r=e.r;t.roughCanvas.circle(r,r,2*r,c(n))},t}();l=i([e.singleton({token:n.CanvasRenderer.CircleRendererContribution})],l);var u=function(){function t(){}return t.prototype.render=function(t,e,n){var r=e.rx,o=e.ry;t.roughCanvas.ellipse(r,o,2*r,2*o,c(n))},t}();u=i([e.singleton({token:n.CanvasRenderer.EllipseRendererContribution})],u);var f=function(){function t(){}return t.prototype.render=function(t,e,n){var r=e.defX,o=void 0===r?0:r,s=e.defY,a=void 0===s?0:s;t.roughCanvas.line(e.x1-o,e.y1-a,e.x2-o,e.y2-a,c(n))},t}();f=i([e.singleton({token:n.CanvasRenderer.LineRendererContribution})],f);var p=function(){function t(){}return t.prototype.render=function(t,n,r){var o=n.defX,s=n.defY;t.roughCanvas.path(e.translatePathToString(n.path.absolutePath,void 0===o?0:o,void 0===s?0:s),c(r))},t}();p=i([e.singleton({token:n.CanvasRenderer.PathRendererContribution})],p);var d=function(){function t(){}return t.prototype.render=function(t,e,n){var r=e.defX,o=void 0===r?0:r,s=e.defY,a=void 0===s?0:s;t.roughCanvas.polygon(e.points.points.map((function(t){return[t[0]-o,t[1]-a]})),c(n))},t}();d=i([e.singleton({token:n.CanvasRenderer.PolygonRendererContribution})],d);var g=function(){function t(){}return t.prototype.render=function(t,e,n){var r=e.defX,o=void 0===r?0:r,s=e.defY,a=void 0===s?0:s;t.roughCanvas.linearPath(e.points.points.map((function(t){return[t[0]-o,t[1]-a]})),c(n))},t}();g=i([e.singleton({token:n.CanvasRenderer.PolylineRendererContribution})],g);var y=function(){function t(){}return t.prototype.render=function(t,e,n){t.roughCanvas.rectangle(0,0,e.width,e.height,c(n))},t}();function v(t,e,n){if(t&&t.length){const[r,o]=e,s=Math.PI/180*n,a=Math.cos(s),i=Math.sin(s);t.forEach((t=>{const[e,n]=t;t[0]=(e-r)*a-(n-o)*i+r,t[1]=(e-r)*i+(n-o)*a+o}))}}function k(t){const e=t[0],n=t[1];return Math.sqrt(Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2))}function M(t,e){const n=e.hachureAngle+90;let r=e.hachureGap;0>r&&(r=4*e.strokeWidth),r=Math.max(r,.1);const o=[0,0];if(n)for(const e of t)v(e,o,n);const s=function(t,e){const n=[];for(const e of t){const t=[...e];t[0].join(",")!==t[t.length-1].join(",")&&t.push([t[0][0],t[0][1]]),t.length>2&&n.push(t)}const r=[];e=Math.max(e,.1);const o=[];for(const t of n)for(let e=0;t.length-1>e;e++){const n=t[e],r=t[e+1];if(n[1]!==r[1]){const t=Math.min(n[1],r[1]);o.push({ymin:t,ymax:Math.max(n[1],r[1]),x:t===n[1]?n[0]:r[0],islope:(r[0]-n[0])/(r[1]-n[1])})}}if(o.sort(((t,e)=>e.ymin>t.ymin?-1:t.ymin>e.ymin?1:e.x>t.x?-1:t.x>e.x?1:t.ymax===e.ymax?0:(t.ymax-e.ymax)/Math.abs(t.ymax-e.ymax))),!o.length)return r;let s=[],a=o[0].ymin;for(;s.length||o.length;){if(o.length){let t=-1;for(let e=0;o.length>e&&o[e].ymin<=a;e++)t=e;o.splice(0,t+1).forEach((t=>{s.push({s:a,edge:t})}))}if(s=s.filter((t=>t.edge.ymax>a)),s.sort(((t,e)=>t.edge.x===e.edge.x?0:(t.edge.x-e.edge.x)/Math.abs(t.edge.x-e.edge.x))),s.length>1)for(let t=0;s.length>t;t+=2){const e=t+1;if(e>=s.length)break;const n=s[e].edge;r.push([[Math.round(s[t].edge.x),a],[Math.round(n.x),a]])}a+=e,s.forEach((t=>{t.edge.x=t.edge.x+e*t.edge.islope}))}return r}(t,r);if(n){for(const e of t)v(e,o,-n);!function(t,e,n){const r=[];t.forEach((t=>r.push(...t))),v(r,e,n)}(s,o,-n)}return s}y=i([e.singleton({token:n.CanvasRenderer.RectRendererContribution})],y);class m{constructor(t){this.helper=t}fillPolygons(t,e){return this._fillPolygons(t,e)}_fillPolygons(t,e){const n=M(t,e);return{type:"fillSketch",ops:this.renderLines(n,e)}}renderLines(t,e){const n=[];for(const r of t)n.push(...this.helper.doubleLineOps(r[0][0],r[0][1],r[1][0],r[1][1],e));return n}}class b extends m{fillPolygons(t,e){let n=e.hachureGap;0>n&&(n=4*e.strokeWidth),n=Math.max(n,.1);const r=M(t,Object.assign({},e,{hachureGap:n})),o=Math.PI/180*e.hachureAngle,s=[],a=.5*n*Math.cos(o),i=.5*n*Math.sin(o);for(const[t,e]of r)k([t,e])&&s.push([[t[0]-a,t[1]+i],[...e]],[[t[0]+a,t[1]-i],[...e]]);return{type:"fillSketch",ops:this.renderLines(s,e)}}}class w extends m{fillPolygons(t,e){const n=this._fillPolygons(t,e),r=Object.assign({},e,{hachureAngle:e.hachureAngle+90}),o=this._fillPolygons(t,r);return n.ops=n.ops.concat(o.ops),n}}class x{constructor(t){this.helper=t}fillPolygons(t,e){const n=M(t,e=Object.assign({},e,{hachureAngle:0}));return this.dotsOnLines(n,e)}dotsOnLines(t,e){const n=[];let r=e.hachureGap;0>r&&(r=4*e.strokeWidth),r=Math.max(r,.1);let o=e.fillWeight;0>o&&(o=e.strokeWidth/2);const s=r/4;for(const a of t){const t=k(a),i=Math.ceil(t/r)-1,h=t-i*r,c=(a[0][0]+a[1][0])/2-r/4,l=Math.min(a[0][1],a[1][1]);for(let t=0;i>t;t++){const a=l+h+t*r,i=c-s+2*Math.random()*s,u=a-s+2*Math.random()*s,f=this.helper.ellipse(i,u,o,o,e);n.push(...f.ops)}}return{type:"fillSketch",ops:n}}}class P{constructor(t){this.helper=t}fillPolygons(t,e){const n=M(t,e);return{type:"fillSketch",ops:this.dashedLine(n,e)}}dashedLine(t,e){const n=0>e.dashOffset?0>e.hachureGap?4*e.strokeWidth:e.hachureGap:e.dashOffset,r=0>e.dashGap?0>e.hachureGap?4*e.strokeWidth:e.hachureGap:e.dashGap,o=[];return t.forEach((t=>{const s=k(t),a=Math.floor(s/(n+r)),i=(s+r-a*(n+r))/2;let h=t[0],c=t[1];h[0]>c[0]&&(h=t[1],c=t[0]);const l=Math.atan((c[1]-h[1])/(c[0]-h[0]));for(let t=0;a>t;t++){const s=t*(n+r),a=s+n,c=[h[0]+s*Math.cos(l)+i*Math.cos(l),h[1]+s*Math.sin(l)+i*Math.sin(l)],u=[h[0]+a*Math.cos(l)+i*Math.cos(l),h[1]+a*Math.sin(l)+i*Math.sin(l)];o.push(...this.helper.doubleLineOps(c[0],c[1],u[0],u[1],e))}})),o}}class O{constructor(t){this.helper=t}fillPolygons(t,e){const n=0>e.hachureGap?4*e.strokeWidth:e.hachureGap,r=0>e.zigzagOffset?n:e.zigzagOffset,o=M(t,e=Object.assign({},e,{hachureGap:n+r}));return{type:"fillSketch",ops:this.zigzagLines(o,r,e)}}zigzagLines(t,e,n){const r=[];return t.forEach((t=>{const o=k(t),s=Math.round(o/(2*e));let a=t[0],i=t[1];a[0]>i[0]&&(a=t[1],i=t[0]);const h=Math.atan((i[1]-a[1])/(i[0]-a[0]));for(let t=0;s>t;t++){const o=2*t*e,s=2*(t+1)*e,i=Math.sqrt(2*Math.pow(e,2)),c=[a[0]+o*Math.cos(h),a[1]+o*Math.sin(h)],l=[a[0]+s*Math.cos(h),a[1]+s*Math.sin(h)],u=[c[0]+i*Math.cos(h+Math.PI/4),c[1]+i*Math.sin(h+Math.PI/4)];r.push(...this.helper.doubleLineOps(c[0],c[1],u[0],u[1],n),...this.helper.doubleLineOps(u[0],u[1],l[0],l[1],n))}})),r}}const L={};class S{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}const C={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function R(t,e){return t.type===e}function _(t){const e=[],n=function(t){const e=new Array;for(;""!==t;)if(t.match(/^([ \t\r\n,]+)/))t=t.substr(RegExp.$1.length);else if(t.match(/^([aAcChHlLmMqQsStTvVzZ])/))e[e.length]={type:0,text:RegExp.$1},t=t.substr(RegExp.$1.length);else{if(!t.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))return[];e[e.length]={type:1,text:`${parseFloat(RegExp.$1)}`},t=t.substr(RegExp.$1.length)}return e[e.length]={type:2,text:""},e}(t);let r="BOD",o=0,s=n[o];for(;!R(s,2);){let a=0;const i=[];if("BOD"===r){if("M"!==s.text&&"m"!==s.text)return _("M0,0"+t);o++,a=C[s.text],r=s.text}else R(s,1)?a=C[r]:(o++,a=C[s.text],r=s.text);if(o+a>=n.length)throw new Error("Path data ended short");for(let t=o;o+a>t;t++){const e=n[t];if(!R(e,1))throw new Error("Param not a number: "+r+","+e.text);i[i.length]=+e.text}if("number"!=typeof C[r])throw new Error("Bad segment: "+r);e.push({key:r,data:i}),o+=a,s=n[o],"M"===r&&(r="L"),"m"===r&&(r="l")}return e}function D(t){let e=0,n=0,r=0,o=0;const s=[];for(const{key:a,data:i}of t)switch(a){case"M":s.push({key:"M",data:[...i]}),[e,n]=i,[r,o]=i;break;case"m":e+=i[0],n+=i[1],s.push({key:"M",data:[e,n]}),r=e,o=n;break;case"L":s.push({key:"L",data:[...i]}),[e,n]=i;break;case"l":e+=i[0],n+=i[1],s.push({key:"L",data:[e,n]});break;case"C":s.push({key:"C",data:[...i]}),e=i[4],n=i[5];break;case"c":{const t=i.map(((t,r)=>r%2?t+n:t+e));s.push({key:"C",data:t}),e=t[4],n=t[5];break}case"Q":s.push({key:"Q",data:[...i]}),e=i[2],n=i[3];break;case"q":{const t=i.map(((t,r)=>r%2?t+n:t+e));s.push({key:"Q",data:t}),e=t[2],n=t[3];break}case"A":s.push({key:"A",data:[...i]}),e=i[5],n=i[6];break;case"a":e+=i[5],n+=i[6],s.push({key:"A",data:[i[0],i[1],i[2],i[3],i[4],e,n]});break;case"H":s.push({key:"H",data:[...i]}),e=i[0];break;case"h":e+=i[0],s.push({key:"H",data:[e]});break;case"V":s.push({key:"V",data:[...i]}),n=i[0];break;case"v":n+=i[0],s.push({key:"V",data:[n]});break;case"S":s.push({key:"S",data:[...i]}),e=i[2],n=i[3];break;case"s":{const t=i.map(((t,r)=>r%2?t+n:t+e));s.push({key:"S",data:t}),e=t[2],n=t[3];break}case"T":s.push({key:"T",data:[...i]}),e=i[0],n=i[1];break;case"t":e+=i[0],n+=i[1],s.push({key:"T",data:[e,n]});break;case"Z":case"z":s.push({key:"Z",data:[]}),e=r,n=o}return s}function E(t){const e=[];let n="",r=0,o=0,s=0,a=0,i=0,h=0;for(const{key:c,data:l}of t){switch(c){case"M":e.push({key:"M",data:[...l]}),[r,o]=l,[s,a]=l;break;case"C":e.push({key:"C",data:[...l]}),r=l[4],o=l[5],i=l[2],h=l[3];break;case"L":e.push({key:"L",data:[...l]}),[r,o]=l;break;case"H":r=l[0],e.push({key:"L",data:[r,o]});break;case"V":o=l[0],e.push({key:"L",data:[r,o]});break;case"S":{let t=0,s=0;"C"===n||"S"===n?(t=r+(r-i),s=o+(o-h)):(t=r,s=o),e.push({key:"C",data:[t,s,...l]}),i=l[0],h=l[1],r=l[2],o=l[3];break}case"T":{const[t,s]=l;let a=0,c=0;"Q"===n||"T"===n?(a=r+(r-i),c=o+(o-h)):(a=r,c=o);e.push({key:"C",data:[r+2*(a-r)/3,o+2*(c-o)/3,t+2*(a-t)/3,s+2*(c-s)/3,t,s]}),i=a,h=c,r=t,o=s;break}case"Q":{const[t,n,s,a]=l;e.push({key:"C",data:[r+2*(t-r)/3,o+2*(n-o)/3,s+2*(t-s)/3,a+2*(n-a)/3,s,a]}),i=t,h=n,r=s,o=a;break}case"A":{const t=Math.abs(l[0]),n=Math.abs(l[1]),s=l[2],a=l[3],i=l[4],h=l[5],c=l[6];if(0===t||0===n)e.push({key:"C",data:[r,o,h,c,h,c]}),r=h,o=c;else if(r!==h||o!==c){A(r,o,h,c,t,n,s,a,i).forEach((function(t){e.push({key:"C",data:t})})),r=h,o=c}break}case"Z":e.push({key:"Z",data:[]}),r=s,o=a}n=c}return e}function T(t,e,n){return[t*Math.cos(n)-e*Math.sin(n),t*Math.sin(n)+e*Math.cos(n)]}function A(t,e,n,r,o,s,a,i,h,c){const l=Math.PI*a/180;let u=[],f=0,p=0,d=0,g=0;if(c)[f,p,d,g]=c;else{[t,e]=T(t,e,-l),[n,r]=T(n,r,-l);const a=(t-n)/2,c=(e-r)/2;let u=a*a/(o*o)+c*c/(s*s);u>1&&(u=Math.sqrt(u),o*=u,s*=u);const y=o*o,v=s*s,k=(i===h?-1:1)*Math.sqrt(Math.abs((y*v-y*c*c-v*a*a)/(y*c*c+v*a*a)));d=k*o*c/s+(t+n)/2,g=k*-s*a/o+(e+r)/2,f=Math.asin(parseFloat(((e-g)/s).toFixed(9))),p=Math.asin(parseFloat(((r-g)/s).toFixed(9))),d>t&&(f=Math.PI-f),d>n&&(p=Math.PI-p),0>f&&(f=2*Math.PI+f),0>p&&(p=2*Math.PI+p),h&&f>p&&(f-=2*Math.PI),!h&&p>f&&(p-=2*Math.PI)}let y=p-f;if(Math.abs(y)>120*Math.PI/180){const t=p,e=n,i=r;p=h&&p>f?f+120*Math.PI/180*1:f+120*Math.PI/180*-1,u=A(n=d+o*Math.cos(p),r=g+s*Math.sin(p),e,i,o,s,a,0,h,[p,t,d,g])}y=p-f;const v=Math.cos(f),k=Math.sin(f),M=Math.cos(p),m=Math.sin(p),b=Math.tan(y/4),w=4/3*o*b,x=4/3*s*b,P=[t,e],O=[t+w*k,e-x*v],L=[n+w*m,r-x*M],S=[n,r];if(O[0]=2*P[0]-O[0],O[1]=2*P[1]-O[1],c)return[O,L,S].concat(u);{u=[O,L,S].concat(u);const t=[];for(let e=0;u.length>e;e+=3){const n=T(u[e][0],u[e][1],l),r=T(u[e+1][0],u[e+1][1],l),o=T(u[e+2][0],u[e+2][1],l);t.push([n[0],n[1],r[0],r[1],o[0],o[1]])}return t}}const j={randOffset:function(t,e){return H(t,e)},randOffsetWithRange:function(t,e,n){return Q(t,e,n)},ellipse:function(t,e,n,r,o){const s=F(n,r,o);return $(t,e,o,s).opset},doubleLineOps:function(t,e,n,r,o){return Y(t,e,n,r,o,!0)}};function I(t,e,n,r,o){return{type:"path",ops:Y(t,e,n,r,o)}}function G(t,e,n){const r=(t||[]).length;if(r>2){const o=[];for(let e=0;r-1>e;e++)o.push(...Y(t[e][0],t[e][1],t[e+1][0],t[e+1][1],n));return e&&o.push(...Y(t[r-1][0],t[r-1][1],t[0][0],t[0][1],n)),{type:"path",ops:o}}return 2===r?I(t[0][0],t[0][1],t[1][0],t[1][1],n):{type:"path",ops:[]}}function W(t,e,n,r,o){return function(t,e){return G(t,!0,e)}([[t,e],[t+n,e],[t+n,e+r],[t,e+r]],o)}function z(t,e){let n=B(t,1*(1+.2*e.roughness),e);if(!e.disableMultiStroke){const r=B(t,1.5*(1+.22*e.roughness),function(t){const e=Object.assign({},t);e.randomizer=void 0,t.seed&&(e.seed=t.seed+1);return e}(e));n=n.concat(r)}return{type:"path",ops:n}}function F(t,e,n){const r=Math.sqrt(2*Math.PI*Math.sqrt((Math.pow(t/2,2)+Math.pow(e/2,2))/2)),o=Math.ceil(Math.max(n.curveStepCount,n.curveStepCount/Math.sqrt(200)*r)),s=2*Math.PI/o;let a=Math.abs(t/2),i=Math.abs(e/2);const h=1-n.curveFitting;return a+=H(a*h,n),i+=H(i*h,n),{increment:s,rx:a,ry:i}}function $(t,e,n,r){const[o,s]=K(r.increment,t,e,r.rx,r.ry,1,r.increment*Q(.1,Q(.4,1,n),n),n);let a=J(o,null,n);if(!n.disableMultiStroke&&0!==n.roughness){const[o]=K(r.increment,t,e,r.rx,r.ry,1.5,0,n),s=J(o,null,n);a=a.concat(s)}return{estimatedPoints:s,opset:{type:"path",ops:a}}}function q(t,e,n,r,o,s,a,i,h){const c=t,l=e;let u=Math.abs(n/2),f=Math.abs(r/2);u+=H(.01*u,h),f+=H(.01*f,h);let p=o,d=s;for(;0>p;)p+=2*Math.PI,d+=2*Math.PI;d-p>2*Math.PI&&(p=0,d=2*Math.PI);const g=2*Math.PI/h.curveStepCount,y=Math.min(g/2,(d-p)/2),v=U(y,c,l,u,f,p,d,1,h);if(!h.disableMultiStroke){const t=U(y,c,l,u,f,p,d,1.5,h);v.push(...t)}return a&&(i?v.push(...Y(c,l,c+u*Math.cos(p),l+f*Math.sin(p),h),...Y(c,l,c+u*Math.cos(d),l+f*Math.sin(d),h)):v.push({op:"lineTo",data:[c,l]},{op:"lineTo",data:[c+u*Math.cos(p),l+f*Math.sin(p)]})),{type:"path",ops:v}}function N(t,e){const n=[];for(const r of t)if(r.length){const t=e.maxRandomnessOffset||0,o=r.length;if(o>2){n.push({op:"move",data:[r[0][0]+H(t,e),r[0][1]+H(t,e)]});for(let s=1;o>s;s++)n.push({op:"lineTo",data:[r[s][0]+H(t,e),r[s][1]+H(t,e)]})}}return{type:"fillPath",ops:n}}function V(t,e){return function(t,e){let n=t.fillStyle||"hachure";if(!L[n])switch(n){case"zigzag":L[n]||(L[n]=new b(e));break;case"cross-hatch":L[n]||(L[n]=new w(e));break;case"dots":L[n]||(L[n]=new x(e));break;case"dashed":L[n]||(L[n]=new P(e));break;case"zigzag-line":L[n]||(L[n]=new O(e));break;default:n="hachure",L[n]||(L[n]=new m(e))}return L[n]}(e,j).fillPolygons(t,e)}function Z(t){return t.randomizer||(t.randomizer=new S(t.seed||0)),t.randomizer.next()}function Q(t,e,n,r=1){return n.roughness*r*(Z(n)*(e-t)+t)}function H(t,e,n=1){return Q(-t,t,e,n)}function Y(t,e,n,r,o,s=!1){const a=s?o.disableMultiStrokeFill:o.disableMultiStroke,i=X(t,e,n,r,o,!0,!1);if(a)return i;const h=X(t,e,n,r,o,!0,!0);return i.concat(h)}function X(t,e,n,r,o,s,a){const i=Math.pow(t-n,2)+Math.pow(e-r,2),h=Math.sqrt(i);let c=1;c=200>h?1:h>500?.4:-.0016668*h+1.233334;let l=o.maxRandomnessOffset||0;l*l*100>i&&(l=h/10);const u=l/2,f=.2+.2*Z(o);let p=o.bowing*o.maxRandomnessOffset*(r-e)/200,d=o.bowing*o.maxRandomnessOffset*(t-n)/200;p=H(p,o,c),d=H(d,o,c);const g=[],y=()=>H(u,o,c),v=()=>H(l,o,c),k=o.preserveVertices;return s&&g.push(a?{op:"move",data:[t+(k?0:y()),e+(k?0:y())]}:{op:"move",data:[t+(k?0:H(l,o,c)),e+(k?0:H(l,o,c))]}),g.push(a?{op:"bcurveTo",data:[p+t+(n-t)*f+y(),d+e+(r-e)*f+y(),p+t+2*(n-t)*f+y(),d+e+2*(r-e)*f+y(),n+(k?0:y()),r+(k?0:y())]}:{op:"bcurveTo",data:[p+t+(n-t)*f+v(),d+e+(r-e)*f+v(),p+t+2*(n-t)*f+v(),d+e+2*(r-e)*f+v(),n+(k?0:v()),r+(k?0:v())]}),g}function B(t,e,n){const r=[];r.push([t[0][0]+H(e,n),t[0][1]+H(e,n)]),r.push([t[0][0]+H(e,n),t[0][1]+H(e,n)]);for(let o=1;t.length>o;o++)r.push([t[o][0]+H(e,n),t[o][1]+H(e,n)]),o===t.length-1&&r.push([t[o][0]+H(e,n),t[o][1]+H(e,n)]);return J(r,null,n)}function J(t,e,n){const r=t.length,o=[];if(r>3){const s=[],a=1-n.curveTightness;o.push({op:"move",data:[t[1][0],t[1][1]]});for(let e=1;r>e+2;e++){const n=t[e];s[0]=[n[0],n[1]],s[1]=[n[0]+(a*t[e+1][0]-a*t[e-1][0])/6,n[1]+(a*t[e+1][1]-a*t[e-1][1])/6],s[2]=[t[e+1][0]+(a*t[e][0]-a*t[e+2][0])/6,t[e+1][1]+(a*t[e][1]-a*t[e+2][1])/6],s[3]=[t[e+1][0],t[e+1][1]],o.push({op:"bcurveTo",data:[s[1][0],s[1][1],s[2][0],s[2][1],s[3][0],s[3][1]]})}if(e&&2===e.length){const t=n.maxRandomnessOffset;o.push({op:"lineTo",data:[e[0]+H(t,n),e[1]+H(t,n)]})}}else 3===r?(o.push({op:"move",data:[t[1][0],t[1][1]]}),o.push({op:"bcurveTo",data:[t[1][0],t[1][1],t[2][0],t[2][1],t[2][0],t[2][1]]})):2===r&&o.push(...Y(t[0][0],t[0][1],t[1][0],t[1][1],n));return o}function K(t,e,n,r,o,s,a,i){const h=[],c=[];if(0===i.roughness){t/=4,c.push([e+r*Math.cos(-t),n+o*Math.sin(-t)]);for(let s=0;s<=2*Math.PI;s+=t){const t=[e+r*Math.cos(s),n+o*Math.sin(s)];h.push(t),c.push(t)}c.push([e+r*Math.cos(0),n+o*Math.sin(0)]),c.push([e+r*Math.cos(t),n+o*Math.sin(t)])}else{const l=H(.5,i)-Math.PI/2;c.push([H(s,i)+e+.9*r*Math.cos(l-t),H(s,i)+n+.9*o*Math.sin(l-t)]);const u=2*Math.PI+l-.01;for(let a=l;u>a;a+=t){const t=[H(s,i)+e+r*Math.cos(a),H(s,i)+n+o*Math.sin(a)];h.push(t),c.push(t)}c.push([H(s,i)+e+r*Math.cos(l+2*Math.PI+.5*a),H(s,i)+n+o*Math.sin(l+2*Math.PI+.5*a)]),c.push([H(s,i)+e+.98*r*Math.cos(l+a),H(s,i)+n+.98*o*Math.sin(l+a)]),c.push([H(s,i)+e+.9*r*Math.cos(l+.5*a),H(s,i)+n+.9*o*Math.sin(l+.5*a)])}return[c,h]}function U(t,e,n,r,o,s,a,i,h){const c=s+H(.1,h),l=[];l.push([H(i,h)+e+.9*r*Math.cos(c-t),H(i,h)+n+.9*o*Math.sin(c-t)]);for(let s=c;a>=s;s+=t)l.push([H(i,h)+e+r*Math.cos(s),H(i,h)+n+o*Math.sin(s)]);return l.push([e+r*Math.cos(a),n+o*Math.sin(a)]),l.push([e+r*Math.cos(a),n+o*Math.sin(a)]),J(l,null,h)}function tt(t,e,n,r,o,s,a,i){const h=[],c=[i.maxRandomnessOffset||1,(i.maxRandomnessOffset||1)+.3];let l=[0,0];const u=i.disableMultiStroke?1:2,f=i.preserveVertices;for(let p=0;u>p;p++)h.push(0===p?{op:"move",data:[a[0],a[1]]}:{op:"move",data:[a[0]+(f?0:H(c[0],i)),a[1]+(f?0:H(c[0],i))]}),l=f?[o,s]:[o+H(c[p],i),s+H(c[p],i)],h.push({op:"bcurveTo",data:[t+H(c[p],i),e+H(c[p],i),n+H(c[p],i),r+H(c[p],i),l[0],l[1]]});return h}function et(t){return[...t]}function nt(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)}function rt(t,e,n){const r=nt(e,n);if(0===r)return nt(t,e);let o=((t[0]-e[0])*(n[0]-e[0])+(t[1]-e[1])*(n[1]-e[1]))/r;return o=Math.max(0,Math.min(1,o)),nt(t,ot(e,n,o))}function ot(t,e,n){return[t[0]+(e[0]-t[0])*n,t[1]+(e[1]-t[1])*n]}function st(t,e,n,r){const o=r||[];if(function(t,e){const n=t[e+0],r=t[e+1],o=t[e+2],s=t[e+3];let a=3*r[0]-2*n[0]-s[0];a*=a;let i=3*r[1]-2*n[1]-s[1];i*=i;let h=3*o[0]-2*s[0]-n[0];h*=h;let c=3*o[1]-2*s[1]-n[1];return c*=c,h>a&&(a=h),c>i&&(i=c),a+i}(t,e)<n){const n=t[e+0];if(o.length){Math.sqrt(nt(o[o.length-1],n))>1&&o.push(n)}else o.push(n);o.push(t[e+3])}else{const r=.5,s=t[e+0],a=t[e+1],i=t[e+2],h=t[e+3],c=ot(s,a,r),l=ot(a,i,r),u=ot(i,h,r),f=ot(c,l,r),p=ot(l,u,r),d=ot(f,p,r);st([s,c,f,d],0,n,o),st([d,p,u,h],0,n,o)}return o}function at(t,e){return it(t,0,t.length,e)}function it(t,e,n,r,o){const s=o||[],a=t[e],i=t[n-1];let h=0,c=1;for(let r=e+1;n-1>r;++r){const e=rt(t[r],a,i);e>h&&(h=e,c=r)}return Math.sqrt(h)>r?(it(t,e,c+1,r,s),it(t,c,n,r,s)):(s.length||s.push(a),s.push(i)),s}function ht(t,e=.15,n){const r=[],o=(t.length-1)/3;for(let n=0;o>n;n++){st(t,3*n,e,r)}return n&&n>0?it(r,0,r.length,n):r}const ct="none";class lt{constructor(t){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1},this.config=t||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return Math.floor(Math.random()*2**31)}_o(t){return t?Object.assign({},this.defaultOptions,t):this.defaultOptions}_d(t,e,n){return{shape:t,sets:e||[],options:n||this.defaultOptions}}line(t,e,n,r,o){const s=this._o(o);return this._d("line",[I(t,e,n,r,s)],s)}rectangle(t,e,n,r,o){const s=this._o(o),a=[],i=W(t,e,n,r,s);if(s.fill){const o=[[t,e],[t+n,e],[t+n,e+r],[t,e+r]];a.push("solid"===s.fillStyle?N([o],s):V([o],s))}return s.stroke!==ct&&a.push(i),this._d("rectangle",a,s)}ellipse(t,e,n,r,o){const s=this._o(o),a=[],i=F(n,r,s),h=$(t,e,s,i);if(s.fill)if("solid"===s.fillStyle){const n=$(t,e,s,i).opset;n.type="fillPath",a.push(n)}else a.push(V([h.estimatedPoints],s));return s.stroke!==ct&&a.push(h.opset),this._d("ellipse",a,s)}circle(t,e,n,r){const o=this.ellipse(t,e,n,n,r);return o.shape="circle",o}linearPath(t,e){const n=this._o(e);return this._d("linearPath",[G(t,!1,n)],n)}arc(t,e,n,r,o,s,a=!1,i){const h=this._o(i),c=[],l=q(t,e,n,r,o,s,a,!0,h);if(a&&h.fill)if("solid"===h.fillStyle){const a=Object.assign({},h);a.disableMultiStroke=!0;const i=q(t,e,n,r,o,s,!0,!1,a);i.type="fillPath",c.push(i)}else c.push(function(t,e,n,r,o,s,a){const i=t,h=e;let c=Math.abs(n/2),l=Math.abs(r/2);c+=H(.01*c,a),l+=H(.01*l,a);let u=o,f=s;for(;0>u;)u+=2*Math.PI,f+=2*Math.PI;f-u>2*Math.PI&&(u=0,f=2*Math.PI);const p=(f-u)/a.curveStepCount,d=[];for(let t=u;f>=t;t+=p)d.push([i+c*Math.cos(t),h+l*Math.sin(t)]);return d.push([i+c*Math.cos(f),h+l*Math.sin(f)]),d.push([i,h]),V([d],a)}(t,e,n,r,o,s,h));return h.stroke!==ct&&c.push(l),this._d("arc",c,h)}curve(t,e){const n=this._o(e),r=[],o=z(t,n);if(n.fill&&n.fill!==ct&&t.length>=3){const e=function(t,e=0){const n=t.length;if(3>n)throw new Error("A curve must have at least three points.");const r=[];if(3===n)r.push(et(t[0]),et(t[1]),et(t[2]),et(t[2]));else{const n=[];n.push(t[0],t[0]);for(let e=1;t.length>e;e++)n.push(t[e]),e===t.length-1&&n.push(t[e]);const o=[],s=1-e;r.push(et(n[0]));for(let t=1;n.length>t+2;t++){const e=n[t];o[0]=[e[0],e[1]],o[1]=[e[0]+(s*n[t+1][0]-s*n[t-1][0])/6,e[1]+(s*n[t+1][1]-s*n[t-1][1])/6],o[2]=[n[t+1][0]+(s*n[t][0]-s*n[t+2][0])/6,n[t+1][1]+(s*n[t][1]-s*n[t+2][1])/6],o[3]=[n[t+1][0],n[t+1][1]],r.push(o[1],o[2],o[3])}}return r}(t),o=ht(e,10,(1+n.roughness)/2);r.push("solid"===n.fillStyle?N([o],n):V([o],n))}return n.stroke!==ct&&r.push(o),this._d("curve",r,n)}polygon(t,e){const n=this._o(e),r=[],o=G(t,!0,n);return n.fill&&r.push("solid"===n.fillStyle?N([t],n):V([t],n)),n.stroke!==ct&&r.push(o),this._d("polygon",r,n)}path(t,e){const n=this._o(e),r=[];if(!t)return this._d("path",r,n);t=(t||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");const o=n.fill&&"transparent"!==n.fill&&n.fill!==ct,s=n.stroke!==ct,a=!(!n.simplification||n.simplification>=1),i=function(t,e,n){const r=E(D(_(t))),o=[];let s=[],a=[0,0],i=[];const h=()=>{4>i.length||s.push(...ht(i,e)),i=[]},c=()=>{h(),s.length&&(o.push(s),s=[])};for(const{key:t,data:e}of r)switch(t){case"M":c(),a=[e[0],e[1]],s.push(a);break;case"L":h(),s.push([e[0],e[1]]);break;case"C":if(!i.length){const t=s.length?s[s.length-1]:a;i.push([t[0],t[1]])}i.push([e[0],e[1]]),i.push([e[2],e[3]]),i.push([e[4],e[5]]);break;case"Z":h(),s.push([a[0],a[1]])}if(c(),!n)return o;const l=[];for(const t of o){const e=at(t,n);e.length&&l.push(e)}return l}(t,1,a?4-4*n.simplification:(1+n.roughness)/2);return o&&r.push("solid"===n.fillStyle?N(i,n):V(i,n)),s&&(a?i.forEach((t=>{r.push(G(t,!1,n))})):r.push(function(t,e){const n=E(D(_(t))),r=[];let o=[0,0],s=[0,0];for(const{key:t,data:a}of n)switch(t){case"M":{const t=1*(e.maxRandomnessOffset||0),n=e.preserveVertices;r.push({op:"move",data:a.map((r=>r+(n?0:H(t,e))))}),s=[a[0],a[1]],o=[a[0],a[1]];break}case"L":r.push(...Y(s[0],s[1],a[0],a[1],e)),s=[a[0],a[1]];break;case"C":{const[t,n,o,i,h,c]=a;r.push(...tt(t,n,o,i,h,c,s,e)),s=[h,c];break}case"Z":r.push(...Y(s[0],s[1],o[0],o[1],e)),s=[o[0],o[1]]}return{type:"path",ops:r}}(t,n))),this._d("path",r,n)}opsToPath(t,e){let n="";for(const r of t.ops){const t="number"!=typeof e||0>e?r.data:r.data.map((t=>+t.toFixed(e)));switch(r.op){case"move":n+=`M${t[0]} ${t[1]} `;break;case"bcurveTo":n+=`C${t[0]} ${t[1]}, ${t[2]} ${t[3]}, ${t[4]} ${t[5]} `;break;case"lineTo":n+=`L${t[0]} ${t[1]} `}}return n.trim()}toPaths(t){const e=t.sets||[],n=t.options||this.defaultOptions,r=[];for(const t of e){let e=null;switch(t.type){case"path":e={d:this.opsToPath(t),stroke:n.stroke,strokeWidth:n.strokeWidth,fill:ct};break;case"fillPath":e={d:this.opsToPath(t),stroke:ct,strokeWidth:0,fill:n.fill||ct};break;case"fillSketch":e=this.fillSketch(t,n)}e&&r.push(e)}return r}fillSketch(t,e){let n=e.fillWeight;return 0>n&&(n=e.strokeWidth/2),{d:this.opsToPath(t),stroke:e.fill||ct,strokeWidth:n,fill:ct}}}class ut{constructor(t,e){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.gen=new lt(e)}draw(t){const e=t.sets||[],n=t.options||this.getDefaultOptions(),r=this.ctx,o=t.options.fixedDecimalPlaceDigits;for(const s of e)switch(s.type){case"path":r.save(),r.strokeStyle="none"===n.stroke?"transparent":n.stroke,r.lineWidth=n.strokeWidth,n.strokeLineDash&&r.setLineDash(n.strokeLineDash),n.strokeLineDashOffset&&(r.lineDashOffset=n.strokeLineDashOffset),this._drawToContext(r,s,o),r.restore();break;case"fillPath":r.save(),r.fillStyle=n.fill||"";this._drawToContext(r,s,o,"curve"===t.shape||"polygon"===t.shape||"path"===t.shape?"evenodd":"nonzero"),r.restore();break;case"fillSketch":this.fillSketch(r,s,n)}}fillSketch(t,e,n){let r=n.fillWeight;0>r&&(r=n.strokeWidth/2),t.save(),n.fillLineDash&&t.setLineDash(n.fillLineDash),n.fillLineDashOffset&&(t.lineDashOffset=n.fillLineDashOffset),t.strokeStyle=n.fill||"",t.lineWidth=r,this._drawToContext(t,e,n.fixedDecimalPlaceDigits),t.restore()}_drawToContext(t,e,n,r="nonzero"){t.beginPath();for(const r of e.ops){const e="number"!=typeof n||0>n?r.data:r.data.map((t=>+t.toFixed(n)));switch(r.op){case"move":t.moveTo(e[0],e[1]);break;case"bcurveTo":t.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5]);break;case"lineTo":t.lineTo(e[0],e[1])}}"fillPath"===e.type?t.fill(r):t.stroke()}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(t,e,n,r,o){const s=this.gen.line(t,e,n,r,o);return this.draw(s),s}rectangle(t,e,n,r,o){const s=this.gen.rectangle(t,e,n,r,o);return this.draw(s),s}ellipse(t,e,n,r,o){const s=this.gen.ellipse(t,e,n,r,o);return this.draw(s),s}circle(t,e,n,r){const o=this.gen.circle(t,e,n,r);return this.draw(o),o}linearPath(t,e){const n=this.gen.linearPath(t,e);return this.draw(n),n}polygon(t,e){const n=this.gen.polygon(t,e);return this.draw(n),n}arc(t,e,n,r,o,s,a=!1,i){const h=this.gen.arc(t,e,n,r,o,s,a,i);return this.draw(h),h}curve(t,e){const n=this.gen.curve(t,e);return this.draw(n),n}path(t,e){const n=this.gen.path(t,e);return this.draw(n),n}}const ft="http://www.w3.org/2000/svg";class pt{constructor(t,e){this.svg=t,this.gen=new lt(e)}draw(t){const e=t.sets||[],n=t.options||this.getDefaultOptions(),r=this.svg.ownerDocument||window.document,o=r.createElementNS(ft,"g"),s=t.options.fixedDecimalPlaceDigits;for(const a of e){let e=null;switch(a.type){case"path":e=r.createElementNS(ft,"path"),e.setAttribute("d",this.opsToPath(a,s)),e.setAttribute("stroke",n.stroke),e.setAttribute("stroke-width",n.strokeWidth+""),e.setAttribute("fill","none"),n.strokeLineDash&&e.setAttribute("stroke-dasharray",n.strokeLineDash.join(" ").trim()),n.strokeLineDashOffset&&e.setAttribute("stroke-dashoffset",`${n.strokeLineDashOffset}`);break;case"fillPath":e=r.createElementNS(ft,"path"),e.setAttribute("d",this.opsToPath(a,s)),e.setAttribute("stroke","none"),e.setAttribute("stroke-width","0"),e.setAttribute("fill",n.fill||""),"curve"!==t.shape&&"polygon"!==t.shape||e.setAttribute("fill-rule","evenodd");break;case"fillSketch":e=this.fillSketch(r,a,n)}e&&o.appendChild(e)}return o}fillSketch(t,e,n){let r=n.fillWeight;0>r&&(r=n.strokeWidth/2);const o=t.createElementNS(ft,"path");return o.setAttribute("d",this.opsToPath(e,n.fixedDecimalPlaceDigits)),o.setAttribute("stroke",n.fill||""),o.setAttribute("stroke-width",r+""),o.setAttribute("fill","none"),n.fillLineDash&&o.setAttribute("stroke-dasharray",n.fillLineDash.join(" ").trim()),n.fillLineDashOffset&&o.setAttribute("stroke-dashoffset",`${n.fillLineDashOffset}`),o}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(t,e){return this.gen.opsToPath(t,e)}line(t,e,n,r,o){const s=this.gen.line(t,e,n,r,o);return this.draw(s)}rectangle(t,e,n,r,o){const s=this.gen.rectangle(t,e,n,r,o);return this.draw(s)}ellipse(t,e,n,r,o){const s=this.gen.ellipse(t,e,n,r,o);return this.draw(s)}circle(t,e,n,r){const o=this.gen.circle(t,e,n,r);return this.draw(o)}linearPath(t,e){const n=this.gen.linearPath(t,e);return this.draw(n)}polygon(t,e){const n=this.gen.polygon(t,e);return this.draw(n)}arc(t,e,n,r,o,s,a=!1,i){const h=this.gen.arc(t,e,n,r,o,s,a,i);return this.draw(h)}curve(t,e){const n=this.gen.curve(t,e);return this.draw(n)}path(t,e){const n=this.gen.path(t,e);return this.draw(n)}}var dt,gt,yt={canvas:(t,e)=>new ut(t,e),svg:(t,e)=>new pt(t,e),generator:t=>new lt(t),newSeed:()=>lt.newSeed()},vt=(dt=function(){function t(){this.canvasConfig=void 0,this.contextService=void 0}return t.prototype.apply=function(t){var e=this;t.hooks.init.tapPromise(gt.tag,s(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.canvasConfig.renderer.getConfig().enableDirtyCheck=!1,e.canvasConfig.renderer.getConfig().enableDirtyRectangleRendering=!1,e.contextService.getContext().roughCanvas=yt.canvas(e.contextService.getDomElement());case 4:case"end":return t.stop()}}),t)})))),t.hooks.destroy.tap(gt.tag,(function(){}))},t}(),dt.tag="RoughCanvasRenderer",gt=dt);i([e.inject(e.CanvasConfig),h("design:type",Object)],vt.prototype,"canvasConfig",void 0),i([e.inject(e.ContextService),h("design:type",Object)],vt.prototype,"contextService",void 0),vt=gt=i([e.singleton({contrib:e.RenderingPluginContribution})],vt);var kt=n.CanvasRenderer.CircleRenderer,Mt=n.CanvasRenderer.EllipseRenderer,mt=n.CanvasRenderer.LineRenderer,bt=n.CanvasRenderer.PathRenderer,wt=n.CanvasRenderer.PolygonRenderer,xt=n.CanvasRenderer.PolylineRenderer,Pt=n.CanvasRenderer.RectRenderer,Ot=e.Module((function(t){t(vt),t(l),t(u),t(y),t(f),t(g),t(d),t(p)})),Lt=function(t){var e,n;function r(){for(var e,n=arguments.length,r=new Array(n),o=0;n>o;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).name="rough-canvas-renderer",e}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,a(e,n);var o=r.prototype;return o.init=function(){this.container.remove(kt),this.container.remove(Mt),this.container.remove(Pt),this.container.remove(mt),this.container.remove(xt),this.container.remove(wt),this.container.remove(bt),this.container.load(Ot,!0)},o.destroy=function(){this.container.unload(Ot),this.container.register(kt),this.container.register(Mt),this.container.register(Pt),this.container.register(mt),this.container.register(xt),this.container.register(wt),this.container.register(bt)},r}(e.AbstractRendererPlugin);t.Plugin=Lt,Object.defineProperty(t,"__esModule",{value:!0})}));
