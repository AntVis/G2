!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@antv/g"),require("@antv/g-svg")):"function"==typeof define&&define.amd?define(["exports","@antv/g","@antv/g-svg"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).G=t.G||{},t.G.RoughSVGRenderer={}),t.window.G,t.window.G.SVG)}(this,(function(t,e,n){"use strict";function r(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
r=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",i=s.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function c(t,e,n,r){var s=Object.create((e&&e.prototype instanceof f?e:f).prototype),o=new x(r||[]);return s._invoke=function(t,e,n){var r="suspendedStart";return function(s,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===s)throw o;return L()}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var i=b(a,n);if(i){if(i===u)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var h=l(t,e,n);if("normal"===h.type){if(r=n.done?"completed":"suspendedYield",h.arg===u)continue;return{value:h.arg,done:n.done}}"throw"===h.type&&(r="completed",n.method="throw",n.arg=h.arg)}}}(t,n,o),s}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var u={};function f(){}function p(){}function d(){}var g={};h(g,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(P([])));v&&v!==e&&n.call(v,o)&&(g=v);var k=d.prototype=f.prototype=Object.create(g);function m(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function M(t,e){function r(s,o,a,i){var h=l(t[s],t,o);if("throw"!==h.type){var c=h.arg,u=c.value;return u&&"object"==typeof u&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,a,i)}),(function(t){r("throw",t,a,i)})):e.resolve(u).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,i)}))}i(h.arg)}var s;this._invoke=function(t,n){function o(){return new e((function(e,s){r(t,n,e,s)}))}return s=s?s.then(o,o):o()}}function b(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=l(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,u;var s=r.arg;return s?s.done?(e[t.resultName]=s.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):s:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function w(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(w,this),this.reset(!0)}function P(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,s=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return s.next=s}}return{next:L}}function L(){return{value:void 0,done:!0}}return p.prototype=d,h(k,"constructor",d),h(d,"constructor",p),p.displayName=h(d,i,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,h(t,i,"GeneratorFunction")),t.prototype=Object.create(k),t},t.awrap=function(t){return{__await:t}},m(M.prototype),h(M.prototype,a,(function(){return this})),t.AsyncIterator=M,t.async=function(e,n,r,s,o){void 0===o&&(o=Promise);var a=new M(c(e,n,r,s),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},m(k),h(k,i,"Generator"),h(k,o,(function(){return this})),h(k,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=P,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return r("end");if(this.prev>=o.tryLoc){var i=n.call(o,"catchLoc"),h=n.call(o,"finallyLoc");if(i&&h){if(o.catchLoc>this.prev)return r(o.catchLoc,!0);if(o.finallyLoc>this.prev)return r(o.finallyLoc)}else if(i){if(o.catchLoc>this.prev)return r(o.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(o.finallyLoc>this.prev)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r];if(this.prev>=s.tryLoc&&n.call(s,"finallyLoc")&&s.finallyLoc>this.prev){var o=s;break}}o&&("break"===t||"continue"===t)&&e>=o.tryLoc&&o.finallyLoc>=e&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),S(n),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var s=r.arg;S(n)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},t}function s(t,e,n,r,s,o,a){try{var i=t[o](a),h=i.value}catch(t){return void n(t)}i.done?e(h):Promise.resolve(h).then(r,s)}function o(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function i(t){s(a,r,o,i,h,"next",t)}function h(t){s(a,r,o,i,h,"throw",t)}i(void 0)}))}}function a(t,e){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},a(t,e)}function i(t,e,n,r){var s,o=arguments.length,a=3>o?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var i=t.length-1;i>=0;i--)(s=t[i])&&(a=(3>o?s(a):o>3?s(e,n,a):s(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}function h(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}var c=["bowing","roughness","fill","stroke","lineWidth","seed","fillStyle","fillWeight","hachureAngle","hachureGap","curveStepCount","curveFitting","lineDash","lineDashOffset","fillLineDash","fillLineDashOffset","disableMultiStroke","disableMultiStrokeFill","simplification","dashOffset","dashGap","zigzagOffset","preserveVertices"];function l(t){var e=t.parsedStyle,n=e.stroke,r=e.lineWidth,s=e.fillStyle,o=e.fillWeight,a=e.hachureAngle,i=e.hachureGap,h=e.curveStepCount,c=e.curveFitting,l=e.lineDash,u=e.lineDashOffset,f=e.fillLineDash,p=e.fillLineDashOffset,d=e.disableMultiStroke,g=e.disableMultiStrokeFill,y=e.simplification,v=e.dashOffset,k=e.dashGap,m=e.zigzagOffset,M=e.preserveVertices,b={bowing:e.bowing,roughness:e.roughness,seed:e.seed||t.entity,fill:e.fill.toString(),stroke:n.toString(),strokeWidth:r,fillStyle:s,fillWeight:o,hachureAngle:a,hachureGap:i,curveStepCount:h,curveFitting:c,strokeLineDash:l||[],strokeLineDashOffset:u,fillLineDash:f,fillLineDashOffset:p,disableMultiStroke:d,disableMultiStrokeFill:g,simplification:y,dashOffset:v,dashGap:k,zigzagOffset:m,preserveVertices:M};return Object.keys(b).forEach((function(t){void 0===b[t]&&delete b[t]})),b}var u=function(){function t(){this.canvasConfig=void 0,this.contextService=void 0}var r=t.prototype;return r.createElement=function(t){var r=t.nodeName;switch(r){case e.Shape.CIRCLE:case e.Shape.ELLIPSE:case e.Shape.RECT:case e.Shape.LINE:case e.Shape.POLYGON:case e.Shape.POLYLINE:case e.Shape.PATH:return this.wrapGroup(this.generateSVGElement(t));case e.Shape.GROUP:case e.Shape.IMAGE:case e.Shape.TEXT:case e.Shape.HTML:return n.SVGRenderer.createSVGElement(n.SVGRenderer.SHAPE2TAGS[r]||"g",this.canvasConfig.document||document)}return null},r.destroyElement=function(t,e){},r.wrapGroup=function(t){return t.setAttribute("data-wrapgroup","1"),t},r.shouldUpdateElementAttribute=function(t,e){return[].concat(n.SVGRenderer.SHAPE_UPDATE_DEPS[t.nodeName]||[],c).indexOf(e)>-1},r.updateElementAttribute=function(t,r){var s=t.parsedStyle;switch(t.nodeName){case e.Shape.CIRCLE:case e.Shape.ELLIPSE:case e.Shape.RECT:case e.Shape.LINE:case e.Shape.POLYGON:case e.Shape.POLYLINE:case e.Shape.PATH:for(var o=this.generateSVGElement(t),a=[],i=0;o.childNodes.length>i;i++)a.push(o.childNodes[i]);r.replaceChildren.apply(r,a);break;case e.Shape.IMAGE:n.SVGRenderer.updateImageElementAttribute(r,s);break;case e.Shape.TEXT:n.SVGRenderer.updateTextElementAttribute(r,s)}},r.generateSVGElement=function(t){var r=t.nodeName,s=t.parsedStyle,o=this.contextService.getContext().roughSVG,a=null;switch(r){case e.Shape.CIRCLE:var i=s.r;a=o.circle(i,i,2*i,l(t));break;case e.Shape.ELLIPSE:var h=s.rx,c=s.ry;a=o.ellipse(h,c,2*h,2*c,l(t));break;case e.Shape.RECT:a=o.rectangle(0,0,s.width,s.height,l(t));break;case e.Shape.LINE:var u=s.defX,f=void 0===u?0:u,p=s.defY,d=void 0===p?0:p;a=o.line(s.x1-f,s.y1-d,s.x2-f,s.y2-d,l(t));break;case e.Shape.POLYLINE:var g=s.defX,y=void 0===g?0:g,v=s.defY,k=void 0===v?0:v;a=o.linearPath(s.points.points.map((function(t){return[t[0]-y,t[1]-k]})),l(t));break;case e.Shape.POLYGON:var m=s.defX,M=void 0===m?0:m,b=s.defY,w=void 0===b?0:b;a=o.polygon(s.points.points.map((function(t){return[t[0]-M,t[1]-w]})),l(t));break;case e.Shape.PATH:var S=s.defX,x=s.defY;a=o.path(e.translatePathToString(s.path.absolutePath,void 0===S?0:S,void 0===x?0:x),l(t))}if(a)for(var P=0;a.children.length>P;P++)a.children[P].id=n.SVGRenderer.G_SVG_PREFIX+"_"+t.nodeName+"_rough"+P+"_"+t.entity;return a},t}();function f(t,e,n){if(t&&t.length){const[r,s]=e,o=Math.PI/180*n,a=Math.cos(o),i=Math.sin(o);t.forEach((t=>{const[e,n]=t;t[0]=(e-r)*a-(n-s)*i+r,t[1]=(e-r)*i+(n-s)*a+s}))}}function p(t){const e=t[0],n=t[1];return Math.sqrt(Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2))}function d(t,e){const n=e.hachureAngle+90;let r=e.hachureGap;0>r&&(r=4*e.strokeWidth),r=Math.max(r,.1);const s=[0,0];if(n)for(const e of t)f(e,s,n);const o=function(t,e){const n=[];for(const e of t){const t=[...e];t[0].join(",")!==t[t.length-1].join(",")&&t.push([t[0][0],t[0][1]]),t.length>2&&n.push(t)}const r=[];e=Math.max(e,.1);const s=[];for(const t of n)for(let e=0;t.length-1>e;e++){const n=t[e],r=t[e+1];if(n[1]!==r[1]){const t=Math.min(n[1],r[1]);s.push({ymin:t,ymax:Math.max(n[1],r[1]),x:t===n[1]?n[0]:r[0],islope:(r[0]-n[0])/(r[1]-n[1])})}}if(s.sort(((t,e)=>e.ymin>t.ymin?-1:t.ymin>e.ymin?1:e.x>t.x?-1:t.x>e.x?1:t.ymax===e.ymax?0:(t.ymax-e.ymax)/Math.abs(t.ymax-e.ymax))),!s.length)return r;let o=[],a=s[0].ymin;for(;o.length||s.length;){if(s.length){let t=-1;for(let e=0;s.length>e&&s[e].ymin<=a;e++)t=e;s.splice(0,t+1).forEach((t=>{o.push({s:a,edge:t})}))}if(o=o.filter((t=>t.edge.ymax>a)),o.sort(((t,e)=>t.edge.x===e.edge.x?0:(t.edge.x-e.edge.x)/Math.abs(t.edge.x-e.edge.x))),o.length>1)for(let t=0;o.length>t;t+=2){const e=t+1;if(e>=o.length)break;const n=o[e].edge;r.push([[Math.round(o[t].edge.x),a],[Math.round(n.x),a]])}a+=e,o.forEach((t=>{t.edge.x=t.edge.x+e*t.edge.islope}))}return r}(t,r);if(n){for(const e of t)f(e,s,-n);!function(t,e,n){const r=[];t.forEach((t=>r.push(...t))),f(r,e,n)}(o,s,-n)}return o}i([e.inject(e.CanvasConfig),h("design:type",Object)],u.prototype,"canvasConfig",void 0),i([e.inject(e.ContextService),h("design:type",Object)],u.prototype,"contextService",void 0),u=i([e.singleton({token:n.SVGRenderer.ElementLifeCycleContribution})],u);class g{constructor(t){this.helper=t}fillPolygons(t,e){return this._fillPolygons(t,e)}_fillPolygons(t,e){const n=d(t,e);return{type:"fillSketch",ops:this.renderLines(n,e)}}renderLines(t,e){const n=[];for(const r of t)n.push(...this.helper.doubleLineOps(r[0][0],r[0][1],r[1][0],r[1][1],e));return n}}class y extends g{fillPolygons(t,e){let n=e.hachureGap;0>n&&(n=4*e.strokeWidth),n=Math.max(n,.1);const r=d(t,Object.assign({},e,{hachureGap:n})),s=Math.PI/180*e.hachureAngle,o=[],a=.5*n*Math.cos(s),i=.5*n*Math.sin(s);for(const[t,e]of r)p([t,e])&&o.push([[t[0]-a,t[1]+i],[...e]],[[t[0]+a,t[1]-i],[...e]]);return{type:"fillSketch",ops:this.renderLines(o,e)}}}class v extends g{fillPolygons(t,e){const n=this._fillPolygons(t,e),r=Object.assign({},e,{hachureAngle:e.hachureAngle+90}),s=this._fillPolygons(t,r);return n.ops=n.ops.concat(s.ops),n}}class k{constructor(t){this.helper=t}fillPolygons(t,e){const n=d(t,e=Object.assign({},e,{hachureAngle:0}));return this.dotsOnLines(n,e)}dotsOnLines(t,e){const n=[];let r=e.hachureGap;0>r&&(r=4*e.strokeWidth),r=Math.max(r,.1);let s=e.fillWeight;0>s&&(s=e.strokeWidth/2);const o=r/4;for(const a of t){const t=p(a),i=Math.ceil(t/r)-1,h=t-i*r,c=(a[0][0]+a[1][0])/2-r/4,l=Math.min(a[0][1],a[1][1]);for(let t=0;i>t;t++){const a=l+h+t*r,i=c-o+2*Math.random()*o,u=a-o+2*Math.random()*o,f=this.helper.ellipse(i,u,s,s,e);n.push(...f.ops)}}return{type:"fillSketch",ops:n}}}class m{constructor(t){this.helper=t}fillPolygons(t,e){const n=d(t,e);return{type:"fillSketch",ops:this.dashedLine(n,e)}}dashedLine(t,e){const n=0>e.dashOffset?0>e.hachureGap?4*e.strokeWidth:e.hachureGap:e.dashOffset,r=0>e.dashGap?0>e.hachureGap?4*e.strokeWidth:e.hachureGap:e.dashGap,s=[];return t.forEach((t=>{const o=p(t),a=Math.floor(o/(n+r)),i=(o+r-a*(n+r))/2;let h=t[0],c=t[1];h[0]>c[0]&&(h=t[1],c=t[0]);const l=Math.atan((c[1]-h[1])/(c[0]-h[0]));for(let t=0;a>t;t++){const o=t*(n+r),a=o+n,c=[h[0]+o*Math.cos(l)+i*Math.cos(l),h[1]+o*Math.sin(l)+i*Math.sin(l)],u=[h[0]+a*Math.cos(l)+i*Math.cos(l),h[1]+a*Math.sin(l)+i*Math.sin(l)];s.push(...this.helper.doubleLineOps(c[0],c[1],u[0],u[1],e))}})),s}}class M{constructor(t){this.helper=t}fillPolygons(t,e){const n=0>e.hachureGap?4*e.strokeWidth:e.hachureGap,r=0>e.zigzagOffset?n:e.zigzagOffset,s=d(t,e=Object.assign({},e,{hachureGap:n+r}));return{type:"fillSketch",ops:this.zigzagLines(s,r,e)}}zigzagLines(t,e,n){const r=[];return t.forEach((t=>{const s=p(t),o=Math.round(s/(2*e));let a=t[0],i=t[1];a[0]>i[0]&&(a=t[1],i=t[0]);const h=Math.atan((i[1]-a[1])/(i[0]-a[0]));for(let t=0;o>t;t++){const s=2*t*e,o=2*(t+1)*e,i=Math.sqrt(2*Math.pow(e,2)),c=[a[0]+s*Math.cos(h),a[1]+s*Math.sin(h)],l=[a[0]+o*Math.cos(h),a[1]+o*Math.sin(h)],u=[c[0]+i*Math.cos(h+Math.PI/4),c[1]+i*Math.sin(h+Math.PI/4)];r.push(...this.helper.doubleLineOps(c[0],c[1],u[0],u[1],n),...this.helper.doubleLineOps(u[0],u[1],l[0],l[1],n))}})),r}}const b={};class w{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}const S={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function x(t,e){return t.type===e}function P(t){const e=[],n=function(t){const e=new Array;for(;""!==t;)if(t.match(/^([ \t\r\n,]+)/))t=t.substr(RegExp.$1.length);else if(t.match(/^([aAcChHlLmMqQsStTvVzZ])/))e[e.length]={type:0,text:RegExp.$1},t=t.substr(RegExp.$1.length);else{if(!t.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))return[];e[e.length]={type:1,text:`${parseFloat(RegExp.$1)}`},t=t.substr(RegExp.$1.length)}return e[e.length]={type:2,text:""},e}(t);let r="BOD",s=0,o=n[s];for(;!x(o,2);){let a=0;const i=[];if("BOD"===r){if("M"!==o.text&&"m"!==o.text)return P("M0,0"+t);s++,a=S[o.text],r=o.text}else x(o,1)?a=S[r]:(s++,a=S[o.text],r=o.text);if(s+a>=n.length)throw new Error("Path data ended short");for(let t=s;s+a>t;t++){const e=n[t];if(!x(e,1))throw new Error("Param not a number: "+r+","+e.text);i[i.length]=+e.text}if("number"!=typeof S[r])throw new Error("Bad segment: "+r);e.push({key:r,data:i}),s+=a,o=n[s],"M"===r&&(r="L"),"m"===r&&(r="l")}return e}function L(t){let e=0,n=0,r=0,s=0;const o=[];for(const{key:a,data:i}of t)switch(a){case"M":o.push({key:"M",data:[...i]}),[e,n]=i,[r,s]=i;break;case"m":e+=i[0],n+=i[1],o.push({key:"M",data:[e,n]}),r=e,s=n;break;case"L":o.push({key:"L",data:[...i]}),[e,n]=i;break;case"l":e+=i[0],n+=i[1],o.push({key:"L",data:[e,n]});break;case"C":o.push({key:"C",data:[...i]}),e=i[4],n=i[5];break;case"c":{const t=i.map(((t,r)=>r%2?t+n:t+e));o.push({key:"C",data:t}),e=t[4],n=t[5];break}case"Q":o.push({key:"Q",data:[...i]}),e=i[2],n=i[3];break;case"q":{const t=i.map(((t,r)=>r%2?t+n:t+e));o.push({key:"Q",data:t}),e=t[2],n=t[3];break}case"A":o.push({key:"A",data:[...i]}),e=i[5],n=i[6];break;case"a":e+=i[5],n+=i[6],o.push({key:"A",data:[i[0],i[1],i[2],i[3],i[4],e,n]});break;case"H":o.push({key:"H",data:[...i]}),e=i[0];break;case"h":e+=i[0],o.push({key:"H",data:[e]});break;case"V":o.push({key:"V",data:[...i]}),n=i[0];break;case"v":n+=i[0],o.push({key:"V",data:[n]});break;case"S":o.push({key:"S",data:[...i]}),e=i[2],n=i[3];break;case"s":{const t=i.map(((t,r)=>r%2?t+n:t+e));o.push({key:"S",data:t}),e=t[2],n=t[3];break}case"T":o.push({key:"T",data:[...i]}),e=i[0],n=i[1];break;case"t":e+=i[0],n+=i[1],o.push({key:"T",data:[e,n]});break;case"Z":case"z":o.push({key:"Z",data:[]}),e=r,n=s}return o}function O(t){const e=[];let n="",r=0,s=0,o=0,a=0,i=0,h=0;for(const{key:c,data:l}of t){switch(c){case"M":e.push({key:"M",data:[...l]}),[r,s]=l,[o,a]=l;break;case"C":e.push({key:"C",data:[...l]}),r=l[4],s=l[5],i=l[2],h=l[3];break;case"L":e.push({key:"L",data:[...l]}),[r,s]=l;break;case"H":r=l[0],e.push({key:"L",data:[r,s]});break;case"V":s=l[0],e.push({key:"L",data:[r,s]});break;case"S":{let t=0,o=0;"C"===n||"S"===n?(t=r+(r-i),o=s+(s-h)):(t=r,o=s),e.push({key:"C",data:[t,o,...l]}),i=l[0],h=l[1],r=l[2],s=l[3];break}case"T":{const[t,o]=l;let a=0,c=0;"Q"===n||"T"===n?(a=r+(r-i),c=s+(s-h)):(a=r,c=s);e.push({key:"C",data:[r+2*(a-r)/3,s+2*(c-s)/3,t+2*(a-t)/3,o+2*(c-o)/3,t,o]}),i=a,h=c,r=t,s=o;break}case"Q":{const[t,n,o,a]=l;e.push({key:"C",data:[r+2*(t-r)/3,s+2*(n-s)/3,o+2*(t-o)/3,a+2*(n-a)/3,o,a]}),i=t,h=n,r=o,s=a;break}case"A":{const t=Math.abs(l[0]),n=Math.abs(l[1]),o=l[2],a=l[3],i=l[4],h=l[5],c=l[6];if(0===t||0===n)e.push({key:"C",data:[r,s,h,c,h,c]}),r=h,s=c;else if(r!==h||s!==c){G(r,s,h,c,t,n,o,a,i).forEach((function(t){e.push({key:"C",data:t})})),r=h,s=c}break}case"Z":e.push({key:"Z",data:[]}),r=o,s=a}n=c}return e}function E(t,e,n){return[t*Math.cos(n)-e*Math.sin(n),t*Math.sin(n)+e*Math.cos(n)]}function G(t,e,n,r,s,o,a,i,h,c){const l=Math.PI*a/180;let u=[],f=0,p=0,d=0,g=0;if(c)[f,p,d,g]=c;else{[t,e]=E(t,e,-l),[n,r]=E(n,r,-l);const a=(t-n)/2,c=(e-r)/2;let u=a*a/(s*s)+c*c/(o*o);u>1&&(u=Math.sqrt(u),s*=u,o*=u);const y=s*s,v=o*o,k=(i===h?-1:1)*Math.sqrt(Math.abs((y*v-y*c*c-v*a*a)/(y*c*c+v*a*a)));d=k*s*c/o+(t+n)/2,g=k*-o*a/s+(e+r)/2,f=Math.asin(parseFloat(((e-g)/o).toFixed(9))),p=Math.asin(parseFloat(((r-g)/o).toFixed(9))),d>t&&(f=Math.PI-f),d>n&&(p=Math.PI-p),0>f&&(f=2*Math.PI+f),0>p&&(p=2*Math.PI+p),h&&f>p&&(f-=2*Math.PI),!h&&p>f&&(p-=2*Math.PI)}let y=p-f;if(Math.abs(y)>120*Math.PI/180){const t=p,e=n,i=r;p=h&&p>f?f+120*Math.PI/180*1:f+120*Math.PI/180*-1,u=G(n=d+s*Math.cos(p),r=g+o*Math.sin(p),e,i,s,o,a,0,h,[p,t,d,g])}y=p-f;const v=Math.cos(f),k=Math.sin(f),m=Math.cos(p),M=Math.sin(p),b=Math.tan(y/4),w=4/3*s*b,S=4/3*o*b,x=[t,e],P=[t+w*k,e-S*v],L=[n+w*M,r-S*m],O=[n,r];if(P[0]=2*x[0]-P[0],P[1]=2*x[1]-P[1],c)return[P,L,O].concat(u);{u=[P,L,O].concat(u);const t=[];for(let e=0;u.length>e;e+=3){const n=E(u[e][0],u[e][1],l),r=E(u[e+1][0],u[e+1][1],l),s=E(u[e+2][0],u[e+2][1],l);t.push([n[0],n[1],r[0],r[1],s[0],s[1]])}return t}}const T={randOffset:function(t,e){return F(t,e)},randOffsetWithRange:function(t,e,n){return N(t,e,n)},ellipse:function(t,e,n,r,s){const o=I(n,r,s);return R(t,e,s,o).opset},doubleLineOps:function(t,e,n,r,s){return $(t,e,n,r,s,!0)}};function C(t,e,n,r,s){return{type:"path",ops:$(t,e,n,r,s)}}function _(t,e,n){const r=(t||[]).length;if(r>2){const s=[];for(let e=0;r-1>e;e++)s.push(...$(t[e][0],t[e][1],t[e+1][0],t[e+1][1],n));return e&&s.push(...$(t[r-1][0],t[r-1][1],t[0][0],t[0][1],n)),{type:"path",ops:s}}return 2===r?C(t[0][0],t[0][1],t[1][0],t[1][1],n):{type:"path",ops:[]}}function A(t,e,n,r,s){return function(t,e){return _(t,!0,e)}([[t,e],[t+n,e],[t+n,e+r],[t,e+r]],s)}function D(t,e){let n=H(t,1*(1+.2*e.roughness),e);if(!e.disableMultiStroke){const r=H(t,1.5*(1+.22*e.roughness),function(t){const e=Object.assign({},t);e.randomizer=void 0,t.seed&&(e.seed=t.seed+1);return e}(e));n=n.concat(r)}return{type:"path",ops:n}}function I(t,e,n){const r=Math.sqrt(2*Math.PI*Math.sqrt((Math.pow(t/2,2)+Math.pow(e/2,2))/2)),s=Math.ceil(Math.max(n.curveStepCount,n.curveStepCount/Math.sqrt(200)*r)),o=2*Math.PI/s;let a=Math.abs(t/2),i=Math.abs(e/2);const h=1-n.curveFitting;return a+=F(a*h,n),i+=F(i*h,n),{increment:o,rx:a,ry:i}}function R(t,e,n,r){const[s,o]=Z(r.increment,t,e,r.rx,r.ry,1,r.increment*N(.1,N(.4,1,n),n),n);let a=Y(s,null,n);if(!n.disableMultiStroke&&0!==n.roughness){const[s]=Z(r.increment,t,e,r.rx,r.ry,1.5,0,n),o=Y(s,null,n);a=a.concat(o)}return{estimatedPoints:o,opset:{type:"path",ops:a}}}function j(t,e,n,r,s,o,a,i,h){const c=t,l=e;let u=Math.abs(n/2),f=Math.abs(r/2);u+=F(.01*u,h),f+=F(.01*f,h);let p=s,d=o;for(;0>p;)p+=2*Math.PI,d+=2*Math.PI;d-p>2*Math.PI&&(p=0,d=2*Math.PI);const g=2*Math.PI/h.curveStepCount,y=Math.min(g/2,(d-p)/2),v=Q(y,c,l,u,f,p,d,1,h);if(!h.disableMultiStroke){const t=Q(y,c,l,u,f,p,d,1.5,h);v.push(...t)}return a&&(i?v.push(...$(c,l,c+u*Math.cos(p),l+f*Math.sin(p),h),...$(c,l,c+u*Math.cos(d),l+f*Math.sin(d),h)):v.push({op:"lineTo",data:[c,l]},{op:"lineTo",data:[c+u*Math.cos(p),l+f*Math.sin(p)]})),{type:"path",ops:v}}function W(t,e){const n=[];for(const r of t)if(r.length){const t=e.maxRandomnessOffset||0,s=r.length;if(s>2){n.push({op:"move",data:[r[0][0]+F(t,e),r[0][1]+F(t,e)]});for(let o=1;s>o;o++)n.push({op:"lineTo",data:[r[o][0]+F(t,e),r[o][1]+F(t,e)]})}}return{type:"fillPath",ops:n}}function z(t,e){return function(t,e){let n=t.fillStyle||"hachure";if(!b[n])switch(n){case"zigzag":b[n]||(b[n]=new y(e));break;case"cross-hatch":b[n]||(b[n]=new v(e));break;case"dots":b[n]||(b[n]=new k(e));break;case"dashed":b[n]||(b[n]=new m(e));break;case"zigzag-line":b[n]||(b[n]=new M(e));break;default:n="hachure",b[n]||(b[n]=new g(e))}return b[n]}(e,T).fillPolygons(t,e)}function V(t){return t.randomizer||(t.randomizer=new w(t.seed||0)),t.randomizer.next()}function N(t,e,n,r=1){return n.roughness*r*(V(n)*(e-t)+t)}function F(t,e,n=1){return N(-t,t,e,n)}function $(t,e,n,r,s,o=!1){const a=o?s.disableMultiStrokeFill:s.disableMultiStroke,i=q(t,e,n,r,s,!0,!1);if(a)return i;const h=q(t,e,n,r,s,!0,!0);return i.concat(h)}function q(t,e,n,r,s,o,a){const i=Math.pow(t-n,2)+Math.pow(e-r,2),h=Math.sqrt(i);let c=1;c=200>h?1:h>500?.4:-.0016668*h+1.233334;let l=s.maxRandomnessOffset||0;l*l*100>i&&(l=h/10);const u=l/2,f=.2+.2*V(s);let p=s.bowing*s.maxRandomnessOffset*(r-e)/200,d=s.bowing*s.maxRandomnessOffset*(t-n)/200;p=F(p,s,c),d=F(d,s,c);const g=[],y=()=>F(u,s,c),v=()=>F(l,s,c),k=s.preserveVertices;return o&&g.push(a?{op:"move",data:[t+(k?0:y()),e+(k?0:y())]}:{op:"move",data:[t+(k?0:F(l,s,c)),e+(k?0:F(l,s,c))]}),g.push(a?{op:"bcurveTo",data:[p+t+(n-t)*f+y(),d+e+(r-e)*f+y(),p+t+2*(n-t)*f+y(),d+e+2*(r-e)*f+y(),n+(k?0:y()),r+(k?0:y())]}:{op:"bcurveTo",data:[p+t+(n-t)*f+v(),d+e+(r-e)*f+v(),p+t+2*(n-t)*f+v(),d+e+2*(r-e)*f+v(),n+(k?0:v()),r+(k?0:v())]}),g}function H(t,e,n){const r=[];r.push([t[0][0]+F(e,n),t[0][1]+F(e,n)]),r.push([t[0][0]+F(e,n),t[0][1]+F(e,n)]);for(let s=1;t.length>s;s++)r.push([t[s][0]+F(e,n),t[s][1]+F(e,n)]),s===t.length-1&&r.push([t[s][0]+F(e,n),t[s][1]+F(e,n)]);return Y(r,null,n)}function Y(t,e,n){const r=t.length,s=[];if(r>3){const o=[],a=1-n.curveTightness;s.push({op:"move",data:[t[1][0],t[1][1]]});for(let e=1;r>e+2;e++){const n=t[e];o[0]=[n[0],n[1]],o[1]=[n[0]+(a*t[e+1][0]-a*t[e-1][0])/6,n[1]+(a*t[e+1][1]-a*t[e-1][1])/6],o[2]=[t[e+1][0]+(a*t[e][0]-a*t[e+2][0])/6,t[e+1][1]+(a*t[e][1]-a*t[e+2][1])/6],o[3]=[t[e+1][0],t[e+1][1]],s.push({op:"bcurveTo",data:[o[1][0],o[1][1],o[2][0],o[2][1],o[3][0],o[3][1]]})}if(e&&2===e.length){const t=n.maxRandomnessOffset;s.push({op:"lineTo",data:[e[0]+F(t,n),e[1]+F(t,n)]})}}else 3===r?(s.push({op:"move",data:[t[1][0],t[1][1]]}),s.push({op:"bcurveTo",data:[t[1][0],t[1][1],t[2][0],t[2][1],t[2][0],t[2][1]]})):2===r&&s.push(...$(t[0][0],t[0][1],t[1][0],t[1][1],n));return s}function Z(t,e,n,r,s,o,a,i){const h=[],c=[];if(0===i.roughness){t/=4,c.push([e+r*Math.cos(-t),n+s*Math.sin(-t)]);for(let o=0;o<=2*Math.PI;o+=t){const t=[e+r*Math.cos(o),n+s*Math.sin(o)];h.push(t),c.push(t)}c.push([e+r*Math.cos(0),n+s*Math.sin(0)]),c.push([e+r*Math.cos(t),n+s*Math.sin(t)])}else{const l=F(.5,i)-Math.PI/2;c.push([F(o,i)+e+.9*r*Math.cos(l-t),F(o,i)+n+.9*s*Math.sin(l-t)]);const u=2*Math.PI+l-.01;for(let a=l;u>a;a+=t){const t=[F(o,i)+e+r*Math.cos(a),F(o,i)+n+s*Math.sin(a)];h.push(t),c.push(t)}c.push([F(o,i)+e+r*Math.cos(l+2*Math.PI+.5*a),F(o,i)+n+s*Math.sin(l+2*Math.PI+.5*a)]),c.push([F(o,i)+e+.98*r*Math.cos(l+a),F(o,i)+n+.98*s*Math.sin(l+a)]),c.push([F(o,i)+e+.9*r*Math.cos(l+.5*a),F(o,i)+n+.9*s*Math.sin(l+.5*a)])}return[c,h]}function Q(t,e,n,r,s,o,a,i,h){const c=o+F(.1,h),l=[];l.push([F(i,h)+e+.9*r*Math.cos(c-t),F(i,h)+n+.9*s*Math.sin(c-t)]);for(let o=c;a>=o;o+=t)l.push([F(i,h)+e+r*Math.cos(o),F(i,h)+n+s*Math.sin(o)]);return l.push([e+r*Math.cos(a),n+s*Math.sin(a)]),l.push([e+r*Math.cos(a),n+s*Math.sin(a)]),Y(l,null,h)}function X(t,e,n,r,s,o,a,i){const h=[],c=[i.maxRandomnessOffset||1,(i.maxRandomnessOffset||1)+.3];let l=[0,0];const u=i.disableMultiStroke?1:2,f=i.preserveVertices;for(let p=0;u>p;p++)h.push(0===p?{op:"move",data:[a[0],a[1]]}:{op:"move",data:[a[0]+(f?0:F(c[0],i)),a[1]+(f?0:F(c[0],i))]}),l=f?[s,o]:[s+F(c[p],i),o+F(c[p],i)],h.push({op:"bcurveTo",data:[t+F(c[p],i),e+F(c[p],i),n+F(c[p],i),r+F(c[p],i),l[0],l[1]]});return h}function B(t){return[...t]}function U(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)}function J(t,e,n){const r=U(e,n);if(0===r)return U(t,e);let s=((t[0]-e[0])*(n[0]-e[0])+(t[1]-e[1])*(n[1]-e[1]))/r;return s=Math.max(0,Math.min(1,s)),U(t,K(e,n,s))}function K(t,e,n){return[t[0]+(e[0]-t[0])*n,t[1]+(e[1]-t[1])*n]}function tt(t,e,n,r){const s=r||[];if(function(t,e){const n=t[e+0],r=t[e+1],s=t[e+2],o=t[e+3];let a=3*r[0]-2*n[0]-o[0];a*=a;let i=3*r[1]-2*n[1]-o[1];i*=i;let h=3*s[0]-2*o[0]-n[0];h*=h;let c=3*s[1]-2*o[1]-n[1];return c*=c,h>a&&(a=h),c>i&&(i=c),a+i}(t,e)<n){const n=t[e+0];if(s.length){Math.sqrt(U(s[s.length-1],n))>1&&s.push(n)}else s.push(n);s.push(t[e+3])}else{const r=.5,o=t[e+0],a=t[e+1],i=t[e+2],h=t[e+3],c=K(o,a,r),l=K(a,i,r),u=K(i,h,r),f=K(c,l,r),p=K(l,u,r),d=K(f,p,r);tt([o,c,f,d],0,n,s),tt([d,p,u,h],0,n,s)}return s}function et(t,e){return nt(t,0,t.length,e)}function nt(t,e,n,r,s){const o=s||[],a=t[e],i=t[n-1];let h=0,c=1;for(let r=e+1;n-1>r;++r){const e=J(t[r],a,i);e>h&&(h=e,c=r)}return Math.sqrt(h)>r?(nt(t,e,c+1,r,o),nt(t,c,n,r,o)):(o.length||o.push(a),o.push(i)),o}function rt(t,e=.15,n){const r=[],s=(t.length-1)/3;for(let n=0;s>n;n++){tt(t,3*n,e,r)}return n&&n>0?nt(r,0,r.length,n):r}const st="none";class ot{constructor(t){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1},this.config=t||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return Math.floor(Math.random()*2**31)}_o(t){return t?Object.assign({},this.defaultOptions,t):this.defaultOptions}_d(t,e,n){return{shape:t,sets:e||[],options:n||this.defaultOptions}}line(t,e,n,r,s){const o=this._o(s);return this._d("line",[C(t,e,n,r,o)],o)}rectangle(t,e,n,r,s){const o=this._o(s),a=[],i=A(t,e,n,r,o);if(o.fill){const s=[[t,e],[t+n,e],[t+n,e+r],[t,e+r]];a.push("solid"===o.fillStyle?W([s],o):z([s],o))}return o.stroke!==st&&a.push(i),this._d("rectangle",a,o)}ellipse(t,e,n,r,s){const o=this._o(s),a=[],i=I(n,r,o),h=R(t,e,o,i);if(o.fill)if("solid"===o.fillStyle){const n=R(t,e,o,i).opset;n.type="fillPath",a.push(n)}else a.push(z([h.estimatedPoints],o));return o.stroke!==st&&a.push(h.opset),this._d("ellipse",a,o)}circle(t,e,n,r){const s=this.ellipse(t,e,n,n,r);return s.shape="circle",s}linearPath(t,e){const n=this._o(e);return this._d("linearPath",[_(t,!1,n)],n)}arc(t,e,n,r,s,o,a=!1,i){const h=this._o(i),c=[],l=j(t,e,n,r,s,o,a,!0,h);if(a&&h.fill)if("solid"===h.fillStyle){const a=Object.assign({},h);a.disableMultiStroke=!0;const i=j(t,e,n,r,s,o,!0,!1,a);i.type="fillPath",c.push(i)}else c.push(function(t,e,n,r,s,o,a){const i=t,h=e;let c=Math.abs(n/2),l=Math.abs(r/2);c+=F(.01*c,a),l+=F(.01*l,a);let u=s,f=o;for(;0>u;)u+=2*Math.PI,f+=2*Math.PI;f-u>2*Math.PI&&(u=0,f=2*Math.PI);const p=(f-u)/a.curveStepCount,d=[];for(let t=u;f>=t;t+=p)d.push([i+c*Math.cos(t),h+l*Math.sin(t)]);return d.push([i+c*Math.cos(f),h+l*Math.sin(f)]),d.push([i,h]),z([d],a)}(t,e,n,r,s,o,h));return h.stroke!==st&&c.push(l),this._d("arc",c,h)}curve(t,e){const n=this._o(e),r=[],s=D(t,n);if(n.fill&&n.fill!==st&&t.length>=3){const e=function(t,e=0){const n=t.length;if(3>n)throw new Error("A curve must have at least three points.");const r=[];if(3===n)r.push(B(t[0]),B(t[1]),B(t[2]),B(t[2]));else{const n=[];n.push(t[0],t[0]);for(let e=1;t.length>e;e++)n.push(t[e]),e===t.length-1&&n.push(t[e]);const s=[],o=1-e;r.push(B(n[0]));for(let t=1;n.length>t+2;t++){const e=n[t];s[0]=[e[0],e[1]],s[1]=[e[0]+(o*n[t+1][0]-o*n[t-1][0])/6,e[1]+(o*n[t+1][1]-o*n[t-1][1])/6],s[2]=[n[t+1][0]+(o*n[t][0]-o*n[t+2][0])/6,n[t+1][1]+(o*n[t][1]-o*n[t+2][1])/6],s[3]=[n[t+1][0],n[t+1][1]],r.push(s[1],s[2],s[3])}}return r}(t),s=rt(e,10,(1+n.roughness)/2);r.push("solid"===n.fillStyle?W([s],n):z([s],n))}return n.stroke!==st&&r.push(s),this._d("curve",r,n)}polygon(t,e){const n=this._o(e),r=[],s=_(t,!0,n);return n.fill&&r.push("solid"===n.fillStyle?W([t],n):z([t],n)),n.stroke!==st&&r.push(s),this._d("polygon",r,n)}path(t,e){const n=this._o(e),r=[];if(!t)return this._d("path",r,n);t=(t||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");const s=n.fill&&"transparent"!==n.fill&&n.fill!==st,o=n.stroke!==st,a=!(!n.simplification||n.simplification>=1),i=function(t,e,n){const r=O(L(P(t))),s=[];let o=[],a=[0,0],i=[];const h=()=>{4>i.length||o.push(...rt(i,e)),i=[]},c=()=>{h(),o.length&&(s.push(o),o=[])};for(const{key:t,data:e}of r)switch(t){case"M":c(),a=[e[0],e[1]],o.push(a);break;case"L":h(),o.push([e[0],e[1]]);break;case"C":if(!i.length){const t=o.length?o[o.length-1]:a;i.push([t[0],t[1]])}i.push([e[0],e[1]]),i.push([e[2],e[3]]),i.push([e[4],e[5]]);break;case"Z":h(),o.push([a[0],a[1]])}if(c(),!n)return s;const l=[];for(const t of s){const e=et(t,n);e.length&&l.push(e)}return l}(t,1,a?4-4*n.simplification:(1+n.roughness)/2);return s&&r.push("solid"===n.fillStyle?W(i,n):z(i,n)),o&&(a?i.forEach((t=>{r.push(_(t,!1,n))})):r.push(function(t,e){const n=O(L(P(t))),r=[];let s=[0,0],o=[0,0];for(const{key:t,data:a}of n)switch(t){case"M":{const t=1*(e.maxRandomnessOffset||0),n=e.preserveVertices;r.push({op:"move",data:a.map((r=>r+(n?0:F(t,e))))}),o=[a[0],a[1]],s=[a[0],a[1]];break}case"L":r.push(...$(o[0],o[1],a[0],a[1],e)),o=[a[0],a[1]];break;case"C":{const[t,n,s,i,h,c]=a;r.push(...X(t,n,s,i,h,c,o,e)),o=[h,c];break}case"Z":r.push(...$(o[0],o[1],s[0],s[1],e)),o=[s[0],s[1]]}return{type:"path",ops:r}}(t,n))),this._d("path",r,n)}opsToPath(t,e){let n="";for(const r of t.ops){const t="number"!=typeof e||0>e?r.data:r.data.map((t=>+t.toFixed(e)));switch(r.op){case"move":n+=`M${t[0]} ${t[1]} `;break;case"bcurveTo":n+=`C${t[0]} ${t[1]}, ${t[2]} ${t[3]}, ${t[4]} ${t[5]} `;break;case"lineTo":n+=`L${t[0]} ${t[1]} `}}return n.trim()}toPaths(t){const e=t.sets||[],n=t.options||this.defaultOptions,r=[];for(const t of e){let e=null;switch(t.type){case"path":e={d:this.opsToPath(t),stroke:n.stroke,strokeWidth:n.strokeWidth,fill:st};break;case"fillPath":e={d:this.opsToPath(t),stroke:st,strokeWidth:0,fill:n.fill||st};break;case"fillSketch":e=this.fillSketch(t,n)}e&&r.push(e)}return r}fillSketch(t,e){let n=e.fillWeight;return 0>n&&(n=e.strokeWidth/2),{d:this.opsToPath(t),stroke:e.fill||st,strokeWidth:n,fill:st}}}class at{constructor(t,e){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.gen=new ot(e)}draw(t){const e=t.sets||[],n=t.options||this.getDefaultOptions(),r=this.ctx,s=t.options.fixedDecimalPlaceDigits;for(const o of e)switch(o.type){case"path":r.save(),r.strokeStyle="none"===n.stroke?"transparent":n.stroke,r.lineWidth=n.strokeWidth,n.strokeLineDash&&r.setLineDash(n.strokeLineDash),n.strokeLineDashOffset&&(r.lineDashOffset=n.strokeLineDashOffset),this._drawToContext(r,o,s),r.restore();break;case"fillPath":r.save(),r.fillStyle=n.fill||"";this._drawToContext(r,o,s,"curve"===t.shape||"polygon"===t.shape||"path"===t.shape?"evenodd":"nonzero"),r.restore();break;case"fillSketch":this.fillSketch(r,o,n)}}fillSketch(t,e,n){let r=n.fillWeight;0>r&&(r=n.strokeWidth/2),t.save(),n.fillLineDash&&t.setLineDash(n.fillLineDash),n.fillLineDashOffset&&(t.lineDashOffset=n.fillLineDashOffset),t.strokeStyle=n.fill||"",t.lineWidth=r,this._drawToContext(t,e,n.fixedDecimalPlaceDigits),t.restore()}_drawToContext(t,e,n,r="nonzero"){t.beginPath();for(const r of e.ops){const e="number"!=typeof n||0>n?r.data:r.data.map((t=>+t.toFixed(n)));switch(r.op){case"move":t.moveTo(e[0],e[1]);break;case"bcurveTo":t.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5]);break;case"lineTo":t.lineTo(e[0],e[1])}}"fillPath"===e.type?t.fill(r):t.stroke()}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(t,e,n,r,s){const o=this.gen.line(t,e,n,r,s);return this.draw(o),o}rectangle(t,e,n,r,s){const o=this.gen.rectangle(t,e,n,r,s);return this.draw(o),o}ellipse(t,e,n,r,s){const o=this.gen.ellipse(t,e,n,r,s);return this.draw(o),o}circle(t,e,n,r){const s=this.gen.circle(t,e,n,r);return this.draw(s),s}linearPath(t,e){const n=this.gen.linearPath(t,e);return this.draw(n),n}polygon(t,e){const n=this.gen.polygon(t,e);return this.draw(n),n}arc(t,e,n,r,s,o,a=!1,i){const h=this.gen.arc(t,e,n,r,s,o,a,i);return this.draw(h),h}curve(t,e){const n=this.gen.curve(t,e);return this.draw(n),n}path(t,e){const n=this.gen.path(t,e);return this.draw(n),n}}const it="http://www.w3.org/2000/svg";class ht{constructor(t,e){this.svg=t,this.gen=new ot(e)}draw(t){const e=t.sets||[],n=t.options||this.getDefaultOptions(),r=this.svg.ownerDocument||window.document,s=r.createElementNS(it,"g"),o=t.options.fixedDecimalPlaceDigits;for(const a of e){let e=null;switch(a.type){case"path":e=r.createElementNS(it,"path"),e.setAttribute("d",this.opsToPath(a,o)),e.setAttribute("stroke",n.stroke),e.setAttribute("stroke-width",n.strokeWidth+""),e.setAttribute("fill","none"),n.strokeLineDash&&e.setAttribute("stroke-dasharray",n.strokeLineDash.join(" ").trim()),n.strokeLineDashOffset&&e.setAttribute("stroke-dashoffset",`${n.strokeLineDashOffset}`);break;case"fillPath":e=r.createElementNS(it,"path"),e.setAttribute("d",this.opsToPath(a,o)),e.setAttribute("stroke","none"),e.setAttribute("stroke-width","0"),e.setAttribute("fill",n.fill||""),"curve"!==t.shape&&"polygon"!==t.shape||e.setAttribute("fill-rule","evenodd");break;case"fillSketch":e=this.fillSketch(r,a,n)}e&&s.appendChild(e)}return s}fillSketch(t,e,n){let r=n.fillWeight;0>r&&(r=n.strokeWidth/2);const s=t.createElementNS(it,"path");return s.setAttribute("d",this.opsToPath(e,n.fixedDecimalPlaceDigits)),s.setAttribute("stroke",n.fill||""),s.setAttribute("stroke-width",r+""),s.setAttribute("fill","none"),n.fillLineDash&&s.setAttribute("stroke-dasharray",n.fillLineDash.join(" ").trim()),n.fillLineDashOffset&&s.setAttribute("stroke-dashoffset",`${n.fillLineDashOffset}`),s}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(t,e){return this.gen.opsToPath(t,e)}line(t,e,n,r,s){const o=this.gen.line(t,e,n,r,s);return this.draw(o)}rectangle(t,e,n,r,s){const o=this.gen.rectangle(t,e,n,r,s);return this.draw(o)}ellipse(t,e,n,r,s){const o=this.gen.ellipse(t,e,n,r,s);return this.draw(o)}circle(t,e,n,r){const s=this.gen.circle(t,e,n,r);return this.draw(s)}linearPath(t,e){const n=this.gen.linearPath(t,e);return this.draw(n)}polygon(t,e){const n=this.gen.polygon(t,e);return this.draw(n)}arc(t,e,n,r,s,o,a=!1,i){const h=this.gen.arc(t,e,n,r,s,o,a,i);return this.draw(h)}curve(t,e){const n=this.gen.curve(t,e);return this.draw(n)}path(t,e){const n=this.gen.path(t,e);return this.draw(n)}}var ct,lt,ut={canvas:(t,e)=>new at(t,e),svg:(t,e)=>new ht(t,e),generator:t=>new ot(t),newSeed:()=>ot.newSeed()},ft=(ct=function(){function t(){this.canvasConfig=void 0,this.contextService=void 0}return t.prototype.apply=function(t){var e=this;t.hooks.init.tapPromise(lt.tag,o(r().mark((function t(){var n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(n=e.contextService.getContext()).roughSVG=ut.svg(n);case 2:case"end":return t.stop()}}),t)})))),t.hooks.destroy.tap(lt.tag,(function(){}))},t}(),ct.tag="RoughSVGRenderer",lt=ct);i([e.inject(e.CanvasConfig),h("design:type",Object)],ft.prototype,"canvasConfig",void 0),i([e.inject(e.ContextService),h("design:type",Object)],ft.prototype,"contextService",void 0),ft=lt=i([e.singleton({contrib:e.RenderingPluginContribution})],ft);var pt=e.Module((function(t){t(u),t(ft)})),dt=function(t){var e,n;function r(){for(var e,n=arguments.length,r=new Array(n),s=0;n>s;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))||this).name="rough-svg-renderer",e}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,a(e,n);var s=r.prototype;return s.init=function(){this.container.load(pt,!0)},s.destroy=function(){this.container.unload(pt)},r}(e.AbstractRendererPlugin);t.Plugin=dt,Object.defineProperty(t,"__esModule",{value:!0})}));
